
<!DOCTYPE html>
<html>
<head>
  <title>Class Analysis</title>
  <link rel="stylesheet" href="style.css">
  <script>
    function analyzeClass() {
      const students = JSON.parse(localStorage.getItem('students')) || [];
      const marks = JSON.parse(localStorage.getItem('marks')) || [];
      let report = [];

      students.forEach(student => {
        const entries = marks.filter(m => m.assessNo === student.assessNo);
        let total = 0;
        entries.forEach(m => {
          const avg = (parseFloat(m.midterm) + parseFloat(m.endterm)) / 2;
          total += avg;
        });
        let avg = entries.length ? total / entries.length : 0;
        report.push({ ...student, total: total.toFixed(1), avg: avg.toFixed(2) });
      });

      // Sort by avg descending for Top 5
      const sorted = [...report].sort((a, b) => b.avg - a.avg);
      const top5 = sorted.slice(0, 5);
      const bottom5 = sorted.slice(-5);

      // Gender Analysis
      let genderStats = { M: { EE: 0, ME: 0, AE: 0, BE: 0 }, F: { EE: 0, ME: 0, AE: 0, BE: 0 } };
      report.forEach(r => {
        let band = 'BE';
        if (r.avg >= 80) band = 'EE';
        else if (r.avg >= 60) band = 'ME';
        else if (r.avg >= 40) band = 'AE';
        genderStats[r.gender][band]++;
      });

      document.getElementById('top5').innerHTML = top5.map(s =>
        `<li>${s.assessNo} - ${s.name} (${s.avg})</li>`).join('');
      document.getElementById('bottom5').innerHTML = bottom5.map(s =>
        `<li>${s.assessNo} - ${s.name} (${s.avg})</li>`).join('');

      let genderHtml = '';
      for (let g in genderStats) {
        genderHtml += `<h4>${g === 'M' ? 'Male' : 'Female'}</h4><ul>`;
        for (let b in genderStats[g]) {
          genderHtml += `<li>${b}: ${genderStats[g][b]}</li>`;
        }
        genderHtml += '</ul>';
      }
      document.getElementById('genderStats').innerHTML = genderHtml;
    }

    window.onload = analyzeClass;
  </script>
</head>
<body>
  <div class="header"><h1>Class Performance Analysis</h1></div>
  <div class="container">
    <h2>Top 5 Learners</h2>
    <ul id="top5"></ul>

    <h2>Bottom 5 Learners</h2>
    <ul id="bottom5"></ul>

    <h2>Gender Performance Summary</h2>
    <div id="genderStats"></div>
  </div>
</body>
</html>
